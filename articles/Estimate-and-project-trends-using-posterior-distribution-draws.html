<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimate-and-project-trends-using-posterior-distribution-draws • birdtrends</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate-and-project-trends-using-posterior-distribution-draws">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">birdtrends</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Comparing-trends-over-time.html">Comparing-trends-over-time</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-annual-indices-datasets.html">Estimate and project trends over time</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-BBS-smooth-dataset.html">Estimate-and-project-trends-using-BBS-smooth-dataset</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-posterior-distribution-draws.html">Estimate-and-project-trends-using-posterior-distribution-draws</a></li>
    <li><a class="dropdown-item" href="../articles/Getting_started.html">Getting_started</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ninoxconsulting/birdtrends/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate-and-project-trends-using-posterior-distribution-draws</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ninoxconsulting/birdtrends/blob/main/vignettes/Estimate-and-project-trends-using-posterior-distribution-draws.Rmd" class="external-link"><code>vignettes/Estimate-and-project-trends-using-posterior-distribution-draws.Rmd</code></a></small>
      <div class="d-none name"><code>Estimate-and-project-trends-using-posterior-distribution-draws.Rmd</code></div>
    </div>

    
    
<p>This vignette provides an alternate method for estimating and
predicting trends, similar to those described in the base workflow with
<a href="https://ninoxconsulting.github.io/birdtrends/articles/Estimate-and-project-trends-using-annual-indices-datasets.html">annual
indices data input</a>.</p>
<p>Rather than annual indices, this workflow uses draws of the posterior
distributions of the smooth component of population trajectory, drawn
from a GAMYE Breeding Bird Survey (BBS) model (using bbsBayes2
package).</p>
<p>Note: this vignette assumes you had already followed the steps
outlined <a href="https://ninoxconsulting.github.io/birdtrends/articles/Getting_started.html">here</a></p>
<div class="section level2">
<h2 id="set-up">1. Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>Lets start by loading all the libraries required.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ninoxconsulting/birdtrends" class="external-link">birdtrends</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extract-the-smooth-component-of-bbsbayes2-fit">2. Extract the smooth component of bbsBayes2 fit<a class="anchor" aria-label="anchor" href="#extract-the-smooth-component-of-bbsbayes2-fit"></a>
</h2>
<p>An example data set, draws of the posterior distribution of annual
indices is provided within this package of the Pacific Wren
(“Troglodytes pacificus”), generated using the <a href="https://bbsbayes.github.io/bbsBayes2/" class="external-link">bbsBayes2</a> package. This
data was kindly provided by A.C. Smith. While this dataset was derived
using the bbsBayes model, any Bayesdian trend model output will provide
suitable input.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">posterior_draws_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;       1968     1969     1970     1971     1972     1973     1974     1975</span></span>
<span><span class="co">#&gt; 1 3.082610 3.015123 3.335139 3.489513 3.998989 3.619001 4.508912 4.264301</span></span>
<span><span class="co">#&gt; 2 2.195914 1.689211 2.546438 2.447753 2.762040 3.587828 3.401666 3.499648</span></span>
<span><span class="co">#&gt; 3 2.916118 2.926004 2.971770 3.579696 3.940871 3.867168 4.009389 3.655491</span></span>
<span><span class="co">#&gt; 4 1.820746 1.737737 2.070640 2.766285 3.131045 4.084060 4.052145 4.393454</span></span>
<span><span class="co">#&gt; 5 2.356744 2.349365 2.584446 3.466212 2.953743 3.166799 3.750321 3.728934</span></span>
<span><span class="co">#&gt; 6 2.646876 2.168418 3.196975 2.731517 3.482707 4.229086 3.879769 4.131091</span></span>
<span><span class="co">#&gt;       1976     1977     1978     1979     1980     1981     1982     1983</span></span>
<span><span class="co">#&gt; 1 5.523679 6.477107 5.428108 5.070019 5.697802 6.108185 5.501953 7.615102</span></span>
<span><span class="co">#&gt; 2 3.944120 4.987994 7.100491 4.716335 5.250659 5.678874 6.286118 7.503666</span></span>
<span><span class="co">#&gt; 3 4.725060 5.643631 5.362977 3.814058 4.555867 5.065963 6.022628 7.630880</span></span>
<span><span class="co">#&gt; 4 5.303943 5.844403 6.731438 5.031135 5.325335 6.434128 5.890515 8.319976</span></span>
<span><span class="co">#&gt; 5 4.691596 6.391333 6.529072 5.253243 5.370466 5.762340 6.074689 7.690788</span></span>
<span><span class="co">#&gt; 6 4.975420 4.983748 5.818747 4.391093 6.065233 6.370119 5.694978 6.405580</span></span>
<span><span class="co">#&gt;       1984     1985     1986     1987     1988     1989     1990     1991</span></span>
<span><span class="co">#&gt; 1 6.639433 6.003091 6.078570 5.656441 5.677746 5.447478 6.968777 4.539658</span></span>
<span><span class="co">#&gt; 2 5.256168 5.794810 5.386139 5.227932 5.588750 5.061077 6.958566 4.470953</span></span>
<span><span class="co">#&gt; 3 6.494724 6.363043 5.058897 4.696674 5.452792 4.959325 6.637491 4.231191</span></span>
<span><span class="co">#&gt; 4 5.390953 5.163086 6.493480 5.699207 5.351699 5.243212 6.556881 4.726460</span></span>
<span><span class="co">#&gt; 5 6.971874 6.452838 5.436969 5.631339 5.335568 5.128908 6.775527 4.713633</span></span>
<span><span class="co">#&gt; 6 4.582359 4.919383 5.126643 4.781984 5.503255 5.517258 6.281919 4.550026</span></span>
<span><span class="co">#&gt;       1992     1993     1994     1995     1996     1997     1998     1999</span></span>
<span><span class="co">#&gt; 1 5.618873 3.994067 5.803611 6.028075 5.844031 6.687735 8.833021 7.131837</span></span>
<span><span class="co">#&gt; 2 5.051767 4.109664 4.637254 5.879644 5.372946 5.837089 8.577663 6.594505</span></span>
<span><span class="co">#&gt; 3 5.171576 3.972754 5.647608 6.182540 6.328446 6.258666 9.045663 7.774180</span></span>
<span><span class="co">#&gt; 4 5.796054 4.605419 5.713425 6.473453 5.568326 6.766745 8.318567 7.352257</span></span>
<span><span class="co">#&gt; 5 6.439859 4.625376 5.527326 6.101939 6.042497 5.961249 9.189403 6.880410</span></span>
<span><span class="co">#&gt; 6 5.449645 4.413135 5.369394 5.551198 5.129341 6.110091 7.972287 7.356251</span></span>
<span><span class="co">#&gt;       2000     2001     2002     2003     2004     2005     2006     2007</span></span>
<span><span class="co">#&gt; 1 6.698147 8.112948 6.781053 6.342629 5.114471 4.780090 5.894585 4.826077</span></span>
<span><span class="co">#&gt; 2 6.615099 7.017240 6.268967 6.384377 5.077061 4.518664 4.923334 5.219011</span></span>
<span><span class="co">#&gt; 3 7.233299 9.932660 6.906731 6.971747 5.142817 4.748727 6.886231 4.866096</span></span>
<span><span class="co">#&gt; 4 7.419301 7.266199 7.047002 6.079024 4.837489 4.992385 4.916099 5.142322</span></span>
<span><span class="co">#&gt; 5 6.543977 8.871820 6.585936 6.221444 5.067310 4.375974 5.296561 4.770052</span></span>
<span><span class="co">#&gt; 6 7.489337 7.089186 6.878845 5.835814 4.956890 5.340337 4.719808 4.568851</span></span>
<span><span class="co">#&gt;       2008     2009     2010     2011     2012     2013     2014     2015</span></span>
<span><span class="co">#&gt; 1 4.041358 3.311982 3.956497 3.677391 4.133665 4.523377 4.154316 3.790820</span></span>
<span><span class="co">#&gt; 2 3.815540 2.858512 4.540620 3.186778 3.015334 5.003184 3.879132 4.193345</span></span>
<span><span class="co">#&gt; 3 4.252738 3.321772 4.616294 3.554062 3.549213 4.339809 3.990611 3.759318</span></span>
<span><span class="co">#&gt; 4 3.714625 3.256193 3.857840 2.952423 3.489479 4.673957 3.571859 3.572310</span></span>
<span><span class="co">#&gt; 5 4.099561 3.896718 4.153645 3.561329 3.402610 4.569009 3.715163 3.555024</span></span>
<span><span class="co">#&gt; 6 3.546721 2.805329 3.894595 3.081243 4.037600 4.772590 4.130292 4.412891</span></span>
<span><span class="co">#&gt;       2016     2017     2018     2019     2020     2021     2022</span></span>
<span><span class="co">#&gt; 1 4.338010 2.802719 3.660448 3.050623 2.767314 4.349836 3.403097</span></span>
<span><span class="co">#&gt; 2 4.957471 3.246485 3.143533 2.772658 3.567344 4.593318 3.771982</span></span>
<span><span class="co">#&gt; 3 4.886972 3.182487 3.408514 3.436348 3.423210 4.834125 3.417634</span></span>
<span><span class="co">#&gt; 4 4.730020 2.905104 3.396004 2.709231 3.076085 3.792921 3.240671</span></span>
<span><span class="co">#&gt; 5 4.257917 2.528496 3.035860 3.186154 3.412096 4.005358 3.220321</span></span>
<span><span class="co">#&gt; 6 5.149085 3.517740 3.621099 3.273938 2.909139 4.227224 3.385283</span></span></code></pre></div>
<p>In this example data set we have draws from the posterior ditribution
of the trend model from 1968 to 2022.</p>
<div class="section level3">
<h3 id="fit-a-generalized-additive-model-to-each-draw-gam">2.1 Fit a generalized additive model to each draw (GAM)<a class="anchor" aria-label="anchor" href="#fit-a-generalized-additive-model-to-each-draw-gam"></a>
</h3>
<p>We can fit a General Additive Model (GAM) to each draw to estimate
the overall trend for the species over all years, or a specific date
range. This model fits a smooth time-series function (i.e., the GAM) to
the log-transformed annual estimates of relative abundance.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">posterior_draws_data</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">fitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_gam.html">fit_gam</a></span><span class="op">(</span><span class="va">indat2</span><span class="op">)</span></span>
<span>    </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-trend">3. Calculate trend<a class="anchor" aria-label="anchor" href="#calculate-trend"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">trend_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trend.html">get_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>, start_yr <span class="op">=</span> <span class="fl">2014</span>, end_yr <span class="op">=</span> <span class="fl">2022</span>, method <span class="op">=</span> <span class="st">"gmean"</span><span class="op">)</span></span>
<span>         </span></code></pre></div>
<p>We can summarise the trend estimates to provide a median and
confidence internal</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trend_q0.025 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>         trend_q0.500 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>,<span class="fl">0.500</span><span class="op">)</span>,</span>
<span>         trend_q0.975 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">trend_q0.025</span>, <span class="va">trend_q0.500</span>, <span class="va">trend_q0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   trend_q0.025 trend_q0.500 trend_q0.975</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      -<span style="color: #BB0000;">0.029</span><span style="color: #BB0000; text-decoration: underline;">5</span>     -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">68</span>       0.011<span style="text-decoration: underline;">9</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="project-trend">4. Project trend<a class="anchor" aria-label="anchor" href="#project-trend"></a>
</h3>
<p>We can now use our modeled annual indices and estimated trends for
our given years to project into the future.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">preds_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/proj_trend.html">proj_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>, <span class="va">trend_sm</span>, start_yr <span class="op">=</span> <span class="fl">2023</span>, proj_yr <span class="op">=</span> <span class="fl">2050</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-the-projected-values">5. Plot the projected values<a class="anchor" aria-label="anchor" href="#plot-the-projected-values"></a>
</h3>
<p>Now lets plot the results, to make a “pretty plot” we will use all
the steps we worked through above. This includes 1) raw observed
indices, 2) modeled indices, 3) projected indices generated from our
trends.</p>
<p>Note in the plot below we only had the posterior draws input data and
not the raw annual estimates. In these cases where no raw indices is
supplied, values are based on 95% of distribution of data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gam_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             model_indices <span class="op">=</span> <span class="va">fitted_data</span>,</span>
<span>                             pred_indices <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                             start_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                             end_yr <span class="op">=</span> <span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
<p><img src="Estimate-and-project-trends-using-posterior-distribution-draws_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">gam_plot</span></span></code></pre></div>
<p><img src="Estimate-and-project-trends-using-posterior-distribution-draws_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Genevieve Perkins, Adam C. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
