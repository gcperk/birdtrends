<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimate and projecttrends over time • birdtrends</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate and projecttrends over time">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">birdtrends</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Comparing-trends-over-time.html">Comparing-trends-over-time</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-annual-indices-datasets.html">Estimate and projecttrends over time</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-BBS-smooth-dataset.html">Estimate-and-project-trends-using-BBS-smooth-dataset</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-posterior-distribution-draws.html">Estimate-and-project-trends-using-posterior-distribution-draws</a></li>
    <li><a class="dropdown-item" href="../articles/Getting_started.html">Getting_started</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ninoxconsulting/birdtrends/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate and projecttrends over time</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ninoxconsulting/birdtrends/blob/main/vignettes/Estimate-and-project-trends-using-annual-indices-datasets.Rmd" class="external-link"><code>vignettes/Estimate-and-project-trends-using-annual-indices-datasets.Rmd</code></a></small>
      <div class="d-none name"><code>Estimate-and-project-trends-using-annual-indices-datasets.Rmd</code></div>
    </div>

    
    
<p>We can use the <code>birdtrends</code> package to estimate trends
overtime based on annual indices data. These include information on year
of data, index, and some form of uncertainty.</p>
<p>Note: this vignette assumes you had already followed the steps
outlined <a href="https://ninoxconsulting.github.io/birdtrends/articles/Getting_started.html">here</a></p>
<div class="section level3">
<h3 id="set-up">1. Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h3>
<p>Lets start by loading all the libraries required.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ninoxconsulting/birdtrends" class="external-link">birdtrends</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-the-annual-indices-based-on-input-data-of-observed-annual-indices-">2. Model the annual indices based on input data of observed annual
indices.<a class="anchor" aria-label="anchor" href="#model-the-annual-indices-based-on-input-data-of-observed-annual-indices-"></a>
</h3>
<p>In many cases, we may not have access to the breadth of information
retained in estimating the original modeled annual indices.</p>
<p>An example data set is provided within this package. This is an
annual estimate on the Pacific Wren (“Troglodytes pacificus”), generated
using the <a href="https://bbsbayes.github.io/bbsBayes2/" class="external-link">bbsBayes2</a>
package. This data was kindly provided by A.C. Smith.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">annual_indicies_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;    year index index_q_0.025 index_q_0.975</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>968  2.70          1.90          3.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>969  2.37          1.70          3.29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">1</span>970  2.80          2.09          3.79</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">1</span>971  3.09          2.29          4.18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">1</span>972  3.32          2.49          4.42</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">1</span>973  3.79          3.04          4.77</span></span></code></pre></div>
<p>In this example data set we have an annual index from 1968 to 2022,
along with credible intervals of 2.5% and 97.5%.</p>
<div class="section level4">
<h4 id="fit-a-bayesian-heirachial-gam-hgam">2.1 Fit a Bayesian Heirachial GAM (HGAM)<a class="anchor" aria-label="anchor" href="#fit-a-bayesian-heirachial-gam-hgam"></a>
</h4>
<p>We can fit a hierarchical Bayesian General Additive Model (HGAM) to
estimate the overall trend for the species over all years, or a specific
date range. This model fits a smooth time-series function (i.e., the
GAM) to the log-transformed annual estimates of relative abundance,
while accounting for the uncertainty of each annual estimate (i.e., the
Hierarchical aspect). This is a measurement-error model that assumes
independence in the errors of each annual estimate. This independence
assumption will be false for many sets of estimates (e.g., any estimates
drawn from any model that includes some explicit temporal structure),
but making this independence assumption is reasonable in the absence of
a known autocorrelation structure in the annual errors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">indat1</span> <span class="op">&lt;-</span> <span class="va">annual_indicies_data</span></span>
<span></span>
<span><span class="va">fitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_hgam.html">fit_hgam</a></span><span class="op">(</span><span class="va">indat1</span>, start_yr <span class="op">=</span> <span class="cn">NA</span>, end_yr <span class="op">=</span> <span class="cn">NA</span>, n_knots <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 4 finished in 2.0 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 2.2 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 4 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 2.1 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 2.4 seconds.</span></span>
<span></span>
<span><span class="co"># output the same data in a long format for plotting purposes </span></span>
<span><span class="va">fitted_data_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_hgam.html">fit_hgam</a></span><span class="op">(</span><span class="va">indat1</span>, start_yr <span class="op">=</span> <span class="cn">NA</span>, end_yr <span class="op">=</span> <span class="cn">NA</span>, n_knots <span class="op">=</span> <span class="cn">NA</span>, longform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 4 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 2.3 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 4 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 2.2 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 2.4 seconds.</span></span>
<span></span>
<span></span>
<span><span class="co">## We can also define the start and end time points or number of knots </span></span>
<span></span>
<span><span class="co"># fitted_data &lt;- fit_hgam(indat1, start_yr = 1990, end_yr = 2014, n_knots = NA)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="explore-the-results">2.2 Explore the results<a class="anchor" aria-label="anchor" href="#explore-the-results"></a>
</h4>
<p>Select a subset of all the fitted HGAM models and reformat to long
format. In this example we selected 100 rows for simplicity.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sel_hgams</span> <span class="op">&lt;-</span> <span class="va">fitted_data_wide</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span><span class="va">.</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>draw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>yearn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>         </span></code></pre></div>
<p>We can reformat our original data to use in the plot</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">min_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sel_hgams</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">max_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sel_hgams</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">indat1</span> <span class="op">&lt;-</span> <span class="va">indat1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="va">min_year</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="va">max_year</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>yearn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>Now we can plot the predicted posterior distributions of 100 draws,
along with the raw annual indices data provided.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sel_hgams</span>,</span>
<span>                    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yearn</span>,y <span class="op">=</span> <span class="va">value</span>,</span>
<span>                        group <span class="op">=</span> <span class="va">draw</span>, colour <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">indat1</span>,</span>
<span>                  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yearn</span>, y <span class="op">=</span> <span class="va">index</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">index_q_0.025</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">index_q_0.975</span><span class="op">)</span>,</span>
<span>                  inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp_plot</span></span></code></pre></div>
<p><img src="Estimate-and-project-trends-using-annual-indices-datasets_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
</div>
<div class="section level3">
<h3 id="estimate-trends">3. Estimate trends<a class="anchor" aria-label="anchor" href="#estimate-trends"></a>
</h3>
<p>We can use our modeled values (fitted_data) to estimate a trend over
a given period of time. This can be used to project into the future.</p>
<p>Firstly lets review our data file, we can see each row contains an
estimated indices per year and per posterior draw (n = 4000). The total
lenght of the file is the number of draws x the number of years for
which we have data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fitted_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    draw  year proj_y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  <span style="text-decoration: underline;">1</span>968   2.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1  <span style="text-decoration: underline;">1</span>969   2.36</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1  <span style="text-decoration: underline;">1</span>970   2.58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1  <span style="text-decoration: underline;">1</span>971   2.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1  <span style="text-decoration: underline;">1</span>972   3.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     1  <span style="text-decoration: underline;">1</span>973   3.55</span></span></code></pre></div>
<p>Now we can estimate a trend based on a given time internal and method
of estimating trends. Where no dates are specified, the minimum and
maximum years will be used. Two methods are available to estimate
trends; 1) Geometric mean and 2) Linear regression.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">trend_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trend.html">get_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>, start_yr <span class="op">=</span> <span class="fl">2014</span>, end_yr <span class="op">=</span> <span class="fl">2022</span>, method <span class="op">=</span> <span class="st">"gmean"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trend_sm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    draw trend_log perc_trend</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  -<span style="color: #BB0000;">0.004</span><span style="color: #BB0000; text-decoration: underline;">23</span>     -<span style="color: #BB0000;">0.422</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2  -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">03</span>     -<span style="color: #BB0000;">0.303</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3  -<span style="color: #BB0000;">0.028</span><span style="color: #BB0000; text-decoration: underline;">7</span>      -<span style="color: #BB0000;">2.83</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4  -<span style="color: #BB0000;">0.021</span><span style="color: #BB0000; text-decoration: underline;">4</span>      -<span style="color: #BB0000;">2.12</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5  -<span style="color: #BB0000;">0.013</span><span style="color: #BB0000; text-decoration: underline;">8</span>      -<span style="color: #BB0000;">1.37</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6  -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">1</span>      -<span style="color: #BB0000;">1.69</span></span></span></code></pre></div>
<p>We can summarise the trend estimates to provide a median and
confidence internal</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trend_q0.025 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>         trend_q0.500 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>,<span class="fl">0.500</span><span class="op">)</span>,</span>
<span>         trend_q0.975 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">trend_q0.025</span>, <span class="va">trend_q0.500</span>, <span class="va">trend_q0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   trend_q0.025 trend_q0.500 trend_q0.975</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      -<span style="color: #BB0000;">0.034</span><span style="color: #BB0000; text-decoration: underline;">6</span>      -<span style="color: #BB0000;">0.014</span><span style="color: #BB0000; text-decoration: underline;">4</span>      0.005<span style="text-decoration: underline;">58</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="project-trend">4. Project trend<a class="anchor" aria-label="anchor" href="#project-trend"></a>
</h3>
<p>We can now use our modeled annual indices and estimated trends for
our given years to project into the future.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/proj_trend.html">proj_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>, <span class="va">trend_sm</span>, start_yr <span class="op">=</span> <span class="fl">2023</span>, proj_yr <span class="op">=</span> <span class="fl">2050</span><span class="op">)</span></span>
<span><span class="co">#&gt; hold tight, running the numbers!</span></span>
<span><span class="co">#&gt; ================================================================================</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">preds_sm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;    draw  year proj_y pred_ind</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  <span style="text-decoration: underline;">1</span>968   2.17     2.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1  <span style="text-decoration: underline;">1</span>969   2.36     2.36</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1  <span style="text-decoration: underline;">1</span>970   2.58     2.58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1  <span style="text-decoration: underline;">1</span>971   2.85     2.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1  <span style="text-decoration: underline;">1</span>972   3.17     3.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     1  <span style="text-decoration: underline;">1</span>973   3.55     3.55</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-the-projected-values">5. Plot the projected values<a class="anchor" aria-label="anchor" href="#plot-the-projected-values"></a>
</h3>
<p>Now lets plot the results, to make a “pretty plot” we will use all
the steps we worked through above. This includes 1) raw observed
indices, 2) modeled indices, 3) projected indices generated from our
trends.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hgams_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="va">indat1</span>, </span>
<span>                          model_indices <span class="op">=</span> <span class="va">fitted_data</span>, </span>
<span>                          pred_indices <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                          start_yr <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                          end_yr <span class="op">=</span> <span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
<p><img src="Estimate-and-project-trends-using-annual-indices-datasets_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="additional-targets-and-trend-estimates">Additional targets and trend estimates<a class="anchor" aria-label="anchor" href="#additional-targets-and-trend-estimates"></a>
</h3>
<p>We may also want to track how our predictions are tracking in
relation to short term trends. For example species identified under the
partners in flight have short and long term trends.</p>
<p>For example we may identify a population change from a given time
step (i.e. 2014) to a short and long term trend as a percentage change
in population.</p>
<p>For example we may have a short term target of 2024 with a range of
-2% to 1% we can calculate what the annual index targets range will be.
This can be added to our plots to identify the range we need to meet or
how our predictions are tracking.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_targets.html">get_targets</a></span><span class="op">(</span>model_indices <span class="op">=</span> <span class="va">fitted_data</span>, </span>
<span>                              ref_year <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                              st_year <span class="op">=</span> <span class="fl">2026</span>, </span>
<span>                              st_lu_target_pc <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>                              st_up_target_pc <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                              lt_year <span class="op">=</span> <span class="fl">2046</span>, </span>
<span>                              lt_lu_target_pc <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                              lt_up_target_pc <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hgams_plot_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="va">indat1</span>, </span>
<span>                          model_indices <span class="op">=</span> <span class="va">fitted_data</span>, </span>
<span>                          pred_indices <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                          start_yr <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                          end_yr <span class="op">=</span> <span class="fl">2022</span>, </span>
<span>                          ref_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                          targets <span class="op">=</span> <span class="va">index_baseline</span><span class="op">)</span></span></code></pre></div>
<p><img src="Estimate-and-project-trends-using-annual-indices-datasets_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="estimate-confidence-of-reaching-targets">Estimate confidence of reaching targets<a class="anchor" aria-label="anchor" href="#estimate-confidence-of-reaching-targets"></a>
</h2>
<p>We can use the output of the trends to estimate uncertainty around
meeting future trends. In the example above we can estimate the
probability that we will meet our short- term or long-term targets.</p>
<p>Our theoretical targets for the above example is short term (decrease
of 2% to increase of 1%) and long term target (2046) is (increase
between 5 to 10% )</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># </span></span>
<span><span class="co"># prop_st &lt;- calculate_probs(predicted_trends = preds_sm,</span></span>
<span><span class="co">#                 ref_year = 2014, </span></span>
<span><span class="co">#                 targ_year = 2026, </span></span>
<span><span class="co">#                 prob_decrease = 2,</span></span>
<span><span class="co">#                 prob_increase = 1)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># prop_lt &lt;- calculate_probs(predicted_trends = preds_sm,</span></span>
<span><span class="co">#                 ref_year = 2014, </span></span>
<span><span class="co">#                 targ_year = 2046,</span></span>
<span><span class="co">#                 prob_increase = c(5,10))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># prop_st</span></span>
<span><span class="co"># prop_lt </span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Genevieve Perkins, Adam C. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
