<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparing-trends-over-time • birdtrends</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing-trends-over-time">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">birdtrends</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Comparing-trends-over-time.html">Comparing-trends-over-time</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-annual-indices-datasets.html">Estimate and projecttrends over time</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-BBS-smooth-dataset.html">Estimate-and-project-trends-using-BBS-smooth-dataset</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate-and-project-trends-using-posterior-distribution-draws.html">Estimate-and-project-trends-using-posterior-distribution-draws</a></li>
    <li><a class="dropdown-item" href="../articles/Getting_started.html">Getting_started</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ninoxconsulting/birdtrends/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comparing-trends-over-time</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ninoxconsulting/birdtrends/blob/main/vignettes/Comparing-trends-over-time.Rmd" class="external-link"><code>vignettes/Comparing-trends-over-time.Rmd</code></a></small>
      <div class="d-none name"><code>Comparing-trends-over-time.Rmd</code></div>
    </div>

    
    
<p>In addition to estimating trends and projecting into the <a href="https://ninoxconsulting.github.io/birdtrends/articles/Using-annual-indices-datasets.html">future</a>,
we can use the birdtrend package to explore differences in trends
through time by comparing the posterior distribution of differences
between two or more trend estimates. This can be used to estimate the
acceleration or decceleation of a species’ population trend.</p>
<p>In this example we will compare recent and previous trends for the
Pacific Wren, using the example annual indices dataset in the birdtrend
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ninoxconsulting/birdtrends" class="external-link">birdtrends</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="estimate-trajectory-using-annual-indices">1. Estimate trajectory using annual indices<a class="anchor" aria-label="anchor" href="#estimate-trajectory-using-annual-indices"></a>
</h3>
<p>As we are using annual indices dataset, we can firstly estimate the
trend to fit the data using the fit_hgam() function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indat1</span> <span class="op">&lt;-</span> <span class="va">annual_indicies_data</span></span>
<span></span>
<span><span class="va">fitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_hgam.html">fit_hgam</a></span><span class="op">(</span><span class="va">indat1</span>,</span>
<span>                        start_yr <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                        end_yr <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                        n_knots <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 2.0 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 4 finished in 2.2 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 4 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 2.1 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 2.5 seconds.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-trends">2. Estimate trends<a class="anchor" aria-label="anchor" href="#estimate-trends"></a>
</h3>
<p>Now we have posterior draws of the smoothed population trajectory, we
can estimate trends at two different periods of the trajectory. In this
example we will explore a recent trend (2014-2022) and a previous trend
(2004-2014).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate short term trend </span></span>
<span></span>
<span><span class="va">trend_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trend.html">get_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>,</span>
<span>                         start_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                         end_yr <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>                         method <span class="op">=</span> <span class="st">"gmean"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>trend_short <span class="op">=</span> <span class="va">perc_trend</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># estimate previous trend</span></span>
<span></span>
<span><span class="va">trend_previous</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trend.html">get_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>,</span>
<span>                            start_yr <span class="op">=</span> <span class="fl">2004</span>,</span>
<span>                            end_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                            method <span class="op">=</span> <span class="st">"gmean"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>trend_previous <span class="op">=</span> <span class="va">perc_trend</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-trends-relative-to-targets">3. Plot trends relative to targets<a class="anchor" aria-label="anchor" href="#plot-trends-relative-to-targets"></a>
</h3>
<p>To visualize the difference in trends we can project each trend and
generate a plot to show the difference.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># project short term trend</span></span>
<span><span class="va">proj_trend_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/proj_trend.html">proj_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>,</span>
<span>                               <span class="va">trend_short</span>,</span>
<span>                               start_yr <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>                               proj_yr <span class="op">=</span> <span class="fl">2050</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># project previous trend</span></span>
<span><span class="va">proj_trend_previous</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/proj_trend.html">proj_trend</a></span><span class="op">(</span><span class="va">fitted_data</span>,</span>
<span>                                  <span class="va">trend_previous</span>,</span>
<span>                                  start_yr <span class="op">=</span> <span class="fl">2015</span>,</span>
<span>                                  proj_yr <span class="op">=</span> <span class="fl">2050</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Get target values for plotting</span></span>
<span><span class="va">index_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_targets.html">get_targets</a></span><span class="op">(</span>model_indices <span class="op">=</span> <span class="va">fitted_data</span>,</span>
<span>                              ref_year <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                              st_year <span class="op">=</span> <span class="fl">2026</span>,</span>
<span>                              st_lu_target_pc <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>                              st_up_target_pc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              lt_year <span class="op">=</span> <span class="fl">2046</span>,</span>
<span>                              lt_lu_target_pc <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                              lt_up_target_pc <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate short term plot </span></span>
<span><span class="va">plot_target_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="va">indat1</span>,</span>
<span>                                model_indices <span class="op">=</span> <span class="va">fitted_data</span>,</span>
<span>                                pred_indices <span class="op">=</span> <span class="va">proj_trend_short</span>,</span>
<span>                                start_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                                end_yr <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>                                ref_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                                targets <span class="op">=</span> <span class="va">index_baseline</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Projection of recent trend from 2014-2022"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Comparing-trends-over-time_files/figure-html/projected%20trend-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate short term plot </span></span>
<span><span class="va">plot_target_previous</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="va">indat1</span>,</span>
<span>                                   model_indices <span class="op">=</span> <span class="va">fitted_data</span>,</span>
<span>                                   pred_indices <span class="op">=</span> <span class="va">proj_trend_previous</span>,</span>
<span>                                   start_yr <span class="op">=</span> <span class="fl">2004</span>,</span>
<span>                                   end_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                                   ref_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                                   targets <span class="op">=</span> <span class="va">index_baseline</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Projection of trend from 2004-2014"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Comparing-trends-over-time_files/figure-html/projected%20trend-2.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_target_short</span> <span class="op">/</span> <span class="va">plot_target_previous</span><span class="op">)</span></span></code></pre></div>
<p><img src="Comparing-trends-over-time_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<p>The upper plot shows the projected recent short-term trend, which
suggests there is only a small probability of the species meeting the
2026 or 2046 targets (the orange uncertainty bounds only slightly
overlaps the blue targets). The lower plot shows that the short-term
trend estimated between 2004 and 2014 was more negative than the recent
short-term trend.</p>
</div>
<div class="section level3">
<h3 id="calculate-difference-in-trends">4. Calculate difference in trends<a class="anchor" aria-label="anchor" href="#calculate-difference-in-trends"></a>
</h3>
<p>We can combine the projected estimates for each of the posterior
draws and calculate the difference between the two trends.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_dif</span> <span class="op">&lt;-</span> <span class="va">trend_previous</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">trend_short</span>, by <span class="op">=</span> <span class="st">"draw"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trend_difference <span class="op">=</span> <span class="va">trend_short</span><span class="op">-</span><span class="va">trend_previous</span><span class="op">)</span></span></code></pre></div>
<p>We can use the difference in probability distributions to quantify
the changes between the two trend periods. Lets calculate the 5%, 50%
and 95% confidence estimates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dif_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_dif</span><span class="op">$</span><span class="va">trend_difference</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.5</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dif_trend</span></span>
<span><span class="co">#&gt;   5%  50%  95% </span></span>
<span><span class="co">#&gt; 0.13 2.27 4.35</span></span></code></pre></div>
<p>The short-term recent trend since 2014 is 2.27% greater from the
trend between 2004 and 2014, and that difference is clearly positive,
with a 95% confidence interval from 0.13 to 4.35.</p>
<p>This comparison shows that if the short-term trend estimated between
2004 and 2014 had continued, the species would be further from reaching
the targets. So while the ongoing decline is troubling, the species
recent trends suggest the population is closer to meeting the targets
than they were in 2014.</p>
<p>```</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Genevieve Perkins, Adam C. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
