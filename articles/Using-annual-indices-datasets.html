<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="birdtrends">
<title>Use annual indices and uncertainty to estimate trends over time • birdtrends</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use annual indices and uncertainty to estimate trends over time">
<meta property="og:description" content="birdtrends">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">birdtrends</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Getting_started.html">Getting_started</a>
    <a class="dropdown-item" href="../articles/Using-annual-indices-datasets.html">Use annual indices and uncertainty to estimate trends over time</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ninoxconsulting/birdtrends/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use annual indices and uncertainty to estimate trends over time</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ninoxconsulting/birdtrends/blob/HEAD/vignettes/Using-annual-indices-datasets.Rmd" class="external-link"><code>vignettes/Using-annual-indices-datasets.Rmd</code></a></small>
      <div class="d-none name"><code>Using-annual-indices-datasets.Rmd</code></div>
    </div>

    
    
<p>We can use the <code>birdtrends</code> package to model trends
overtime based on annual indices datasets. These include information on
year of data, index, and some form of uncertainty.</p>
<p>Note: this vignette assumes you had already followed the steps
outlined <a href="https://ninoxconsulting.github.io/birdtrends/articles/Getting_started.html">here</a></p>
<div class="section level3">
<h3 id="set-up">1. Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h3>
<p>Lets start by loading all the libraries required.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ninoxconsulting/birdtrends" class="external-link">birdtrends</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-the-annual-indices-based-on-input-data-of-observed-annual-indices-">2. Model the annual indices based on input data of observed annual
indices.<a class="anchor" aria-label="anchor" href="#model-the-annual-indices-based-on-input-data-of-observed-annual-indices-"></a>
</h3>
<p>In many cases, we may not have access to the breadth of information
retained in estimating the original modeled annual indices.</p>
<p>An example data set is provided within this package. This is an
annual estimate on the Pacific Wren (” “), generated using the <a href="https://bbsbayes.github.io/bbsBayes2/" class="external-link">bbsBayes2</a> package. This
data was kindly provided by A.C. Smith.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">annual_indicies_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;    year index index_q_0.025 index_q_0.975</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">1</span>968  2.70          1.90          3.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">1</span>969  2.37          1.70          3.29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">1</span>970  2.80          2.09          3.79</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">1</span>971  3.09          2.29          4.18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">1</span>972  3.32          2.49          4.42</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">1</span>973  3.79          3.04          4.77</span></span></code></pre></div>
<p>In this example data set we have an annual index from 1968 to 2022,
along with credible intervals of 2.5% and 97.5%.</p>
<div class="section level4">
<h4 id="fit-a-bayesian-heirachial-gam-hgam">2.1 Fit a Bayesian Heirachial GAM (HGAM)<a class="anchor" aria-label="anchor" href="#fit-a-bayesian-heirachial-gam-hgam"></a>
</h4>
<p>We can fit a hierarchical Bayesian General Additive Model (HGAM) to
estimate the overall trend for the species over all years, or a specific
date range. This model fits a smooth time-series function (i.e., the
GAM) to the log-transformed annual estimates of relative abundance,
while accounting for the uncertainty of each annual estimate (i.e., the
Hierarchical aspect). This is a measurement-error model that assumes
independence in the errors of each annual estimate. This independence
assumption will be false for many sets of estimates (e.g., any estimates
drawn from any model that includes some explicit temporal structure),
but making this independence assumption is reasonable in the absence of
a known autocorrelation structure in the annual errors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">indat1</span> <span class="op">&lt;-</span> <span class="va">annual_indicies_data</span></span>
<span></span>
<span><span class="va">fitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_hgam.html">fit_hgam</a></span><span class="op">(</span><span class="va">indat1</span>, start_yr <span class="op">=</span> <span class="cn">NA</span>, end_yr <span class="op">=</span> <span class="cn">NA</span>, n_knots <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 2.0 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 4 finished in 2.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 2.3 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 4 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 2.1 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 2.5 seconds.</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#fitted_data &lt;- fit_hgam(indat1, start_yr = 1990, end_yr = 2014, n_knots = NA)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="explore-the-results">2.2 Explore the results<a class="anchor" aria-label="anchor" href="#explore-the-results"></a>
</h4>
<p>Select a subset of all the fitted HGAM models and reformat to long
format. In this example we selected 100 rows for simplicity.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sel_hgams</span> <span class="op">&lt;-</span> <span class="va">fitted_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span><span class="va">.</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>draw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>yearn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>         </span></code></pre></div>
<p>We can reformat our original data to use in the plot</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">min_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sel_hgams</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">max_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sel_hgams</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">indat1</span> <span class="op">&lt;-</span> <span class="va">indat1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="va">min_year</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="va">max_year</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>yearn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>Now we can plot the predicted posterior distributions of 100 draws,
along with the raw annual indices data provided.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sel_hgams</span>,</span>
<span>                    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yearn</span>,y <span class="op">=</span> <span class="va">value</span>,</span>
<span>                        group <span class="op">=</span> <span class="va">draw</span>, colour <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">indat1</span>,</span>
<span>                  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yearn</span>, y <span class="op">=</span> <span class="va">index</span>,</span>
<span>                      ymin <span class="op">=</span> <span class="va">index_q_0.025</span>,</span>
<span>                      ymax <span class="op">=</span> <span class="va">index_q_0.975</span><span class="op">)</span>,</span>
<span>                  inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp_plot</span></span></code></pre></div>
<p><img src="Using-annual-indices-datasets_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
</div>
<div class="section level3">
<h3 id="estimate-trends">3. Estimate trends<a class="anchor" aria-label="anchor" href="#estimate-trends"></a>
</h3>
<p>We can use our modeled values to estimate a trend over a given period
of time. This can be used to predict into the future.</p>
<p>First we need to reformat our fitted data. We can modify the object
‘sel_hgams’ above or reformat the raw output.</p>
<p>We will convert our data to long form, with the following columns
“draw”, “year”, and “proj_y”. Note if using the output from the
“fit_hgam” we can use the code below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ldf</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span><span class="va">fitted_data</span>, <span class="st">"draw"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">'year'</span> <span class="op">=</span> <span class="va">name</span>, <span class="st">"proj_y"</span> <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This creates a dataset in which each row contains an estimated
indices per year and per posterior draw (n = 4000).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ldf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    draw  year proj_y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  <span style="text-decoration: underline;">1</span>968   2.70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1  <span style="text-decoration: underline;">1</span>969   2.86</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1  <span style="text-decoration: underline;">1</span>970   3.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1  <span style="text-decoration: underline;">1</span>971   3.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1  <span style="text-decoration: underline;">1</span>972   3.44</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     1  <span style="text-decoration: underline;">1</span>973   3.70</span></span></code></pre></div>
<p>Now we can estimate a trend based on a given time internal and method
of estimating trends. Where no dates are specified, the minimum and
maximum years will be used. Two methods are available to estimate
trends; 1) Geometric mean and 2) Linear regression.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">trend_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trend.html">get_trend</a></span><span class="op">(</span><span class="va">ldf</span>, start_yr <span class="op">=</span> <span class="fl">2014</span>, end_yr <span class="op">=</span> <span class="fl">2022</span>, method <span class="op">=</span> <span class="st">"gmean"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trend_sm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;    draw trend_log perc_trend</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1   0.001<span style="text-decoration: underline;">08</span>      0.108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2  -<span style="color: #BB0000;">0.024</span><span style="color: #BB0000; text-decoration: underline;">9</span>      -<span style="color: #BB0000;">2.46</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3  -<span style="color: #BB0000;">0.015</span><span style="color: #BB0000; text-decoration: underline;">1</span>      -<span style="color: #BB0000;">1.50</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4  -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">3</span>      -<span style="color: #BB0000;">1.81</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5  -<span style="color: #BB0000;">0.008</span><span style="color: #BB0000; text-decoration: underline;">42</span>     -<span style="color: #BB0000;">0.839</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6  -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">0</span>      -<span style="color: #BB0000;">1.88</span></span></span></code></pre></div>
<p>We can summarise the trend estimates to provide a median and
confidence internal</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trend_q0.025 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>         trend_q0.500 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>,<span class="fl">0.500</span><span class="op">)</span>,</span>
<span>         trend_q0.975 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trend_log</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">trend_q0.025</span>, <span class="va">trend_q0.500</span>, <span class="va">trend_q0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   trend_q0.025 trend_q0.500 trend_q0.975</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      -<span style="color: #BB0000;">0.035</span><span style="color: #BB0000; text-decoration: underline;">3</span>      -<span style="color: #BB0000;">0.014</span><span style="color: #BB0000; text-decoration: underline;">3</span>      0.006<span style="text-decoration: underline;">46</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predict-trend">4. Predict trend<a class="anchor" aria-label="anchor" href="#predict-trend"></a>
</h3>
<p>We can now use our modeled annual indices and estimated trends for
our given years to predict into the future.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_trend.html">predict_trend</a></span><span class="op">(</span><span class="va">ldf</span>, <span class="va">trend_sm</span>, start_yr <span class="op">=</span> <span class="fl">2023</span>, proj_yr <span class="op">=</span> <span class="fl">2050</span><span class="op">)</span></span>
<span><span class="co">#&gt; hold tight, running the numbers!</span></span>
<span><span class="co">#&gt; ================================================================================</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">preds_sm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;    draw  year proj_y pred_ind</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  <span style="text-decoration: underline;">1</span>968   2.70     2.70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1  <span style="text-decoration: underline;">1</span>969   2.86     2.86</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1  <span style="text-decoration: underline;">1</span>970   3.03     3.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1  <span style="text-decoration: underline;">1</span>971   3.22     3.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1  <span style="text-decoration: underline;">1</span>972   3.44     3.44</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     1  <span style="text-decoration: underline;">1</span>973   3.70     3.70</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-the-prediction">5. Plot the prediction<a class="anchor" aria-label="anchor" href="#plot-the-prediction"></a>
</h3>
<p>Now lets plot the results, to make a “pretty plot” we will use all
the steps we worked through above. This includes 1) raw observed
indices, 2) modeled indices, 3) predicted indices generated from our
trends.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hgams_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="va">indat1</span>, </span>
<span>                          model_indices <span class="op">=</span> <span class="va">ldf</span>, </span>
<span>                          pred_indices <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                          start_yr <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                          end_yr <span class="op">=</span> <span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using-annual-indices-datasets_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="additional-targets-and-trend-estimates">Additional targets and trend estimates<a class="anchor" aria-label="anchor" href="#additional-targets-and-trend-estimates"></a>
</h3>
<p>We may also want to track how our predictions are tracking in
relation to short term trends. For example species identified under the
partners in flight have short and long term trends.</p>
<p>For example we may identify a population change from a given time
step (i.e. 2014) to a short and long term trend as a percentage change
in population.</p>
<p>For example we may have a short term target of 2024 with a range of
-2% to 1% we can calculate what the annual index targets range will be.
This can be added to our plots to identify the range we need to meet or
how our predictions are tracking.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_targets.html">get_targets</a></span><span class="op">(</span>model_indices <span class="op">=</span> <span class="va">ldf</span>, </span>
<span>                              ref_year <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                              st_year <span class="op">=</span> <span class="fl">2026</span>, </span>
<span>                              st_lu_target_pc <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>                              st_up_target_pc <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                              lt_year <span class="op">=</span> <span class="fl">2046</span>, </span>
<span>                              lt_lu_target_pc <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                              lt_up_target_pc <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hgams_plot_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_trend.html">plot_trend</a></span><span class="op">(</span>raw_indices <span class="op">=</span> <span class="va">indat1</span>, </span>
<span>                          model_indices <span class="op">=</span> <span class="va">ldf</span>, </span>
<span>                          pred_indices <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                          start_yr <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                          end_yr <span class="op">=</span> <span class="fl">2022</span>, </span>
<span>                          ref_yr <span class="op">=</span> <span class="fl">2014</span>,</span>
<span>                          targets <span class="op">=</span> <span class="va">index_baseline</span><span class="op">)</span></span></code></pre></div>
<p><img src="Using-annual-indices-datasets_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="estimate-confidence-of-reaching-targets">Estimate confidence of reaching targets<a class="anchor" aria-label="anchor" href="#estimate-confidence-of-reaching-targets"></a>
</h2>
<p>We can use the output of the trends to estimate uncertainty around
meeting future trends. In the example above we can estimate the
probability that we will meet our short- term or long-term targets.</p>
<p>Our theoretical targets for the above example is short term (decrease
of 2% to increase of 1%) and longterm target (2046) is (increase between
5 to 10% )</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">prop_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_probs.html">calculate_probs</a></span><span class="op">(</span>predicted_trends <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                ref_year <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                targ_year <span class="op">=</span> <span class="fl">2026</span>, </span>
<span>                prob_decrease <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                prob_increase <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prop_lt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_probs.html">calculate_probs</a></span><span class="op">(</span>predicted_trends <span class="op">=</span> <span class="va">preds_sm</span>,</span>
<span>                ref_year <span class="op">=</span> <span class="fl">2014</span>, </span>
<span>                targ_year <span class="op">=</span> <span class="fl">2046</span>,</span>
<span>                prob_increase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">prop_st</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   prob_decrease_2_percent prob_increase_1_percent ref_year target_yr</span></span>
<span><span class="co">#&gt;                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    88.9                    7.18     <span style="text-decoration: underline;">2</span>014      <span style="text-decoration: underline;">2</span>026</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prop_lt</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   prob_increase_5_percent prob_increase_10_percent ref_year target_yr</span></span>
<span><span class="co">#&gt;                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                     6.1                     5.03     <span style="text-decoration: underline;">2</span>014      <span style="text-decoration: underline;">2</span>046</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span> </span>
<span><span class="co"># predicted_trends = preds_sm</span></span>
<span><span class="co"># calc_quantiles &lt;- stats::quantile</span></span>
<span><span class="co"># quantiles = c(0.025, 0.05, 0.25, 0.75, 0.95, 0.975)</span></span>
<span><span class="co"># prob_decrease = c(0,2,50)</span></span>
<span><span class="co"># prob_increase = c(0,2,50)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># calc_prob_crease &lt;- function(x, p, type = "decrease") {</span></span>
<span><span class="co">#   if(type == "decrease") f &lt;- function(p) length(x[x &lt; (-1 * p)]) / length(x)</span></span>
<span><span class="co">#   if(type == "increase") f &lt;- function(p) length(x[x &gt; p]) / length(x)</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   vapply(p, FUN = f, FUN.VALUE = 1.1) %&gt;%</span></span>
<span><span class="co">#     stats::setNames(paste0("prob_", type, "_", p, "_percent"))</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # for each draw subtract target year from ref year (2024) - 2014</span></span>
<span><span class="co"># aa &lt;- filter(predicted_trends, year %in% c(2014, 2024)) |&gt; </span></span>
<span><span class="co">#   select(-proj_y)</span></span>
<span><span class="co">#   </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># aa &lt;-  pivot_wider(aa, values_from = pred_ind, names_from = year)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ab &lt;- aa |&gt; </span></span>
<span><span class="co">#   mutate(ch = `2024`/`2014`) |&gt; </span></span>
<span><span class="co">#   rowwise() |&gt; </span></span>
<span><span class="co">#   mutate(ch_pc = 100 * (stats::median(ch) -1)) |&gt; </span></span>
<span><span class="co">#   dplyr::ungroup() %&gt;%</span></span>
<span><span class="co">#   mutate(percent_change_ave = 100 * (stats::median(ch)-1),</span></span>
<span><span class="co">#         #percent_change_q_0.025 = 100 *  (stats::quantile(ch, probs = 0.025)-1),</span></span>
<span><span class="co">#         #percent_change_q_0.05 = 100 *  (stats::quantile(ch, probs = 0.05)-1),</span></span>
<span><span class="co">#         #percent_change_q_0.25 = 100 *  (stats::quantile(ch, probs = 0.25)-1),</span></span>
<span><span class="co">#         #percent_change_q_0.75 = 100 *  (stats::quantile(ch, probs = 0.75)-1),</span></span>
<span><span class="co">#         #percent_change_q_0.95 = 100 *  (stats::quantile(ch, probs = 0.95)-1),</span></span>
<span><span class="co">#         percent_change_q_0.975 = 100 *  (stats::quantile(ch, probs = 0.975)-1))</span></span>
<span><span class="co">#  </span></span>
<span><span class="co">#  </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Model conditional probabilities of population change during trends period</span></span>
<span><span class="co">#   if(!is.null(prob_decrease)) {</span></span>
<span><span class="co">#     ab &lt;- ab %&gt;%</span></span>
<span><span class="co">#       dplyr::mutate(</span></span>
<span><span class="co">#         pch_pp = purrr::map_df(.data$ch_pc, calc_prob_crease,</span></span>
<span><span class="co">#                                .env$prob_decrease, type = "decrease")) %&gt;%</span></span>
<span><span class="co">#       tidyr::unnest("pch_pp") </span></span>
<span><span class="co">#   }</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   if(!is.null(prob_increase)){</span></span>
<span><span class="co">#     ab &lt;- ab %&gt;%</span></span>
<span><span class="co">#       dplyr::mutate(</span></span>
<span><span class="co">#         pch_pp = purrr::map_df(.data$ch_pc, calc_prob_crease,</span></span>
<span><span class="co">#                                .env$prob_increase, type = "increase")) %&gt;%</span></span>
<span><span class="co">#       tidyr::unnest("pch_pp") </span></span>
<span><span class="co">#   }</span></span>
<span><span class="co">#   </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # filter and select only sections needed. </span></span>
<span><span class="co">#  </span></span>
<span><span class="co">#  out &lt;- ab |&gt; </span></span>
<span><span class="co">#   mutate(across(starts_with("prob"), ~ sum(.x, na.rm = TRUE)/length(.x)*100)) %&gt;% </span></span>
<span><span class="co">#   select(starts_with("p"))%&gt;% </span></span>
<span><span class="co">#    distinct()</span></span>
<span><span class="co"># </span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Genevieve Perkins, Adam C. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
